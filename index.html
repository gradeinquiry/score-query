<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆç¸¾æŸ¥è©¢ç³»çµ±</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f7f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .login-card { background: #fff; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 14px; background: #1a73e8; color: #fff; border: none; border-radius: 6px; font-size: 18px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #1557b0; }
        #result { margin-top: 30px; display: none; border-top: 2px solid #eee; padding-top: 20px; }
        .score-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .score-table th, .score-table td { border: 1px solid #eee; padding: 12px; text-align: center; }
        .score-table th { background: #f8f9fa; color: #666; }
        .error { color: #d93025; text-align: center; margin-top: 15px; font-weight: bold; }
        .rank-highlight { font-size: 1.2em; color: #e67e22; font-weight: bold; }
    </style>
</head>
<body>

<div class="login-card">
    <h2>ğŸ† æˆç¸¾æŸ¥è©¢ç³»çµ±</h2>
    
    <div id="login-form">
        <div class="form-group">
            <label>å‡†è€ƒè­‰è™Ÿ (å¸³è™Ÿ)</label>
            <input type="text" id="username" placeholder="è«‹è¼¸å…¥å‡†è€ƒè­‰è™Ÿ">
        </div>
        <div class="form-group">
            <label>æ‰‹æ©Ÿæœ« 4 ç¢¼ (å¯†ç¢¼)</label>
            <input type="password" id="password" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿæœ« 4 ç¢¼">
        </div>
        <button onclick="checkScore()">ç™»å…¥æŸ¥è©¢</button>
        <div id="error-msg" class="error"></div>
    </div>

    <div id="result">
        <h3 id="student-name" style="text-align: center;"></h3>
        <table class="score-table">
            <tr><th>ç§‘ç›®</th><th>åˆ†æ•¸</th></tr>
            <tr><td>åœ‹æ–‡</td><td id="score-chinese"></td></tr>
            <tr><td>æ•¸å­¸</td><td id="score-math"></td></tr>
            <tr><td>è‹±æ–‡</td><td id="score-english"></td></tr>
            <tr><td>ç¸½æˆç¸¾</td><td id="score-total" style="font-weight:bold;"></td></tr>
            <tr><td>å…¨é«”æ’å</td><td id="score-rank" class="rank-highlight"></td></tr>
        </table>
        <button onclick="location.reload()" style="margin-top: 20px; background: #666;">å›ä¸Šä¸€é </button>
    </div>
</div>

<script>
    async function checkScore() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const errorMsg = document.getElementById('error-msg');
        errorMsg.innerText = "";

        if (!username || !password) {
            errorMsg.innerText = "è«‹å¡«å¯«å¸³è™ŸåŠå¯†ç¢¼";
            return;
        }

        try {
            // 1. å˜—è©¦æŠ“å–è©²å­¸ç”Ÿçš„è³‡æ–™æª”æ¡ˆ
            const response = await fetch(`data/${username}.json`);
            
            if (!response.ok) {
                errorMsg.innerText = "æ‰¾ä¸åˆ°æ­¤å‡†è€ƒè­‰è™Ÿï¼Œè«‹æª¢æŸ¥è¼¸å…¥æ˜¯å¦æ­£ç¢ºã€‚";
                return;
            }

            const data = await response.json();

            // 2. é©—è­‰æ‰‹æ©Ÿæœ« 4 ç¢¼ (å–å‡ºå®¶é•·æ‰‹æ©Ÿæ¬„ä½çš„æœ€å¾Œ 4 ä½æ•¸)
            // æ”¯æ´æ¬„ä½åï¼šå®¶é•·æ‰‹æ©Ÿ æˆ– æ‰‹æ©Ÿ
            const phone = (data['å®¶é•·æ‰‹æ©Ÿ'] || data['æ‰‹æ©Ÿ'] || "").toString();
            const lastFour = phone.slice(-4);

            if (password !== lastFour) {
                errorMsg.innerText = "å¯†ç¢¼éŒ¯èª¤ (æ‰‹æ©Ÿæœ« 4 ç¢¼ä¸ç¬¦)ã€‚";
                return;
            }

            // 3. é¡¯ç¤ºçµæœ
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            document.getElementById('student-name').innerText = data['å­¸ç”Ÿå§“å'] + " åŒå­¸";
            document.getElementById('score-chinese').innerText = data['åœ‹æ–‡'];
            document.getElementById('score-math').innerText = data['æ•¸å­¸'];
            document.getElementById('score-english').innerText = data['è‹±æ–‡'];
            document.getElementById('score-total').innerText = data['ç¸½æˆç¸¾'];
            document.getElementById('score-rank').innerText = "ç¬¬ " + data['æ’å'] + " å";

        } catch (err) {
            errorMsg.innerText = "é€£ç·šç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            console.error(err);
        }
    }
</script>

</body>
</html>