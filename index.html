<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>普門中學115年第2次學藝競賽</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", sans-serif; }
        .query-card { max-width: 450px; margin: 50px auto; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: none; }
        .card-header { background: #1e3a8a; color: white; text-align: center; padding: 25px; border-radius: 15px 15px 0 0 !important; }
        .result-box { display: none; margin-top: 20px; }
        .table th { width: 40%; }
        .hint-text { font-size: 0.85rem; color: #6c757d; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card query-card">
        <div class="card-header">
            <h4 class="mb-0">普門中學115年第2次學藝競賽</h4>
            <p class="mb-0 mt-2 opacity-75" style="font-size: 0.9rem;">成績查詢系統</p>
        </div>
        <div class="card-body p-4">
            <div class="mb-3">
                <label class="form-label fw-bold">查詢帳號</label>
                <input type="text" id="userInput" class="form-control" placeholder="請輸入6位數帳號">
                <div class="hint-text">說明：考場(4位) + 准考證號末2位<br>範例：1203 + 01 = 120301</div>
            </div>
            <div class="mb-4">
                <label class="form-label fw-bold">密碼 (手機末4碼)</label>
                <input type="password" id="passInput" class="form-control" placeholder="請輸入手機末4碼">
            </div>
            <button onclick="search()" class="btn btn-primary w-100 py-2 fw-bold shadow-sm">立即查詢成績</button>

            <div id="resultArea" class="result-box">
                <div class="alert alert-success text-center py-1 fw-bold">查詢成功</div>
                <table class="table table-bordered align-middle">
                    <tr><th class="bg-light">考生姓名</th><td id="resName"></td></tr>
                    <tr><th class="bg-light">國文</th><td id="resChi"></td></tr>
                    <tr><th class="bg-light">數學</th><td id="resMat"></td></tr>
                    <tr><th class="bg-light">英文</th><td id="resEng"></td></tr>
                    <tr><th class="bg-light">總分</th><td id="resTotal" class="text-primary fw-bold"></td></tr>
                    <tr id="rankRow"><th class="bg-light">排名</th><td id="resRank" class="fw-bold text-danger"></td></tr>
                </table>
                <div id="rankHint" class="text-center mt-3 text-muted" style="font-size: 0.8rem; display:none;">
                    註：排名僅顯示前 10 名。
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function search() {
        const user = document.getElementById('userInput').value.trim(); // 預期為 6 碼
        const pass = document.getElementById('passInput').value.trim();
        const resultArea = document.getElementById('resultArea');
        const rankRow = document.getElementById('rankRow');
        const rankHint = document.getElementById('rankHint');

        if(!user || !pass) { alert("請填寫帳號與密碼"); return; }

        Papa.parse("data.csv", {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                const data = results.data;
                
                // 比對邏輯：
                // row['合併准考證號'] 是 10 碼 (例如 1204201025)
                // 我們取它的前 4 碼 (考場) + 後 2 碼 (准考證末2碼) 來跟使用者輸入的 6 碼比對
                const match = data.find(row => {
                    const fullID = String(row['合併准考證號']).trim();
                    const shortID = fullID.substring(0, 4) + fullID.substring(fullID.length - 2);
                    return shortID === user && String(row['家長手機']).trim() === pass;
                });

                if (match) {
                    document.getElementById('resName').innerText = match['學生姓名'];
                    document.getElementById('resChi').innerText = match['國文'];
                    document.getElementById('resMat').innerText = match['數學'];
                    document.getElementById('resEng').innerText = match['英文'];
                    document.getElementById('resTotal').innerText = match['總成績'];
                    
                    const rankNum = parseInt(match['排名']);
                    if (!isNaN(rankNum) && rankNum <= 10) {
                        document.getElementById('resRank').innerText = "第 " + rankNum + " 名";
                        rankRow.style.display = 'table-row';
                        rankHint.style.display = 'block';
                    } else {
                        rankRow.style.display = 'none';
                        rankHint.style.display = 'none';
                    }

                    resultArea.style.display = 'block';
                } else {
                    alert("查無資料，請確認 6 位數帳號與手機末 4 碼是否正確。");
                    resultArea.style.display = 'none';
                }
            }
        });
    }
</script>
</body>
</html>